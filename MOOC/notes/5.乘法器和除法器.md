# 第五章 乘法器和除法器

## 5.1 乘法的运算过程

### 竖式计算

### 较为简单的数字选择：二进制

### 十进制和二进制运算的选择

关于EDVAC的报告草案，1945，约翰•冯•诺依曼

电子管是一种“全或无”设备（all-or-none），适合表示只有两个数值的系统，即二进制。

二进制可以大幅度地简化乘法和除法的运算过程。尤其是对于乘法，不再需要十进制乘法表，也不再需要两轮的加法。

必须要记住，十进制才是适合人使用的。因此，输入输出设备需要承担二进制和十进制之间的转换工作。

## 5.2 乘法器的实现

### 乘法器的实现结构

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.38.53@2x.png" alt="CleanShot 2024-03-27 at 13.38.53@2x" style="zoom:30%;" />

### 乘法器的工作过程

#### 乘法器的工作过程（初始化）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.40.10@2x.png" alt="CleanShot 2024-03-27 at 13.40.10@2x" style="zoom:30%;" />

#### 乘法器的工作过程（1a）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.41.11@2x.png" alt="CleanShot 2024-03-27 at 13.41.11@2x" style="zoom:30%;" />

#### 乘法器的工作过程（2）

准备被乘数

控制逻辑会给出左移的信号，那么在下一个时钟上升沿来临的时候，被乘数寄存器就会完成一次左移。

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.43.27@2x.png" alt="CleanShot 2024-03-27 at 13.43.27@2x" style="zoom:30%;" />

#### 乘法器的工作过程（3）

准备乘数

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.43.51@2x.png" alt="CleanShot 2024-03-27 at 13.43.51@2x" style="zoom:30%;" />

#### 乘法器的工作过程（4）

检查循环是否结束，如果循环了四次就说明乘法完成

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.45.28@2x.png" alt="CleanShot 2024-03-27 at 13.45.28@2x" style="zoom:30%;" />

#### 乘法器的工作过程（1、2、3、4） 第2、3、4轮

### N位乘法器的工作流程图

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.49.57@2x.png" alt="CleanShot 2024-03-27 at 13.49.57@2x" style="zoom:30%;" />

## 5.3 乘法器的优化1

### N位乘法器的工作流程图

时钟周期很多

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.51.45@2x.png" alt="CleanShot 2024-03-27 at 13.51.45@2x" style="zoom:30%;" />

### 乘法器的优化1：加法移位并行

时钟上升沿到来时，寄存器根据输入改变其内容

在计算一次乘法的时候，同时将被乘数寄存器和乘数寄存器移位，时钟周期变为 1/3

### N位乘法器的工作流程优化

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 13.55.49@2x.png" alt="CleanShot 2024-03-27 at 13.55.49@2x" style="zoom:30%;" />

## 5.4 乘法器的优化2

### 乘法器的优化2：减少不必要的硬件资源

1. “被乘数寄存器”是8位宽，但其中有效数字始终只有4位
2. “乘数寄存器”是4位宽，最开始没有浪费；但其中有效数字每周期减少1位，之后有浪费
3. “乘积寄存器”是8位宽，但初始时有效数字只有4位，有浪费；之后每周期增加1位，最后才没有浪费
4. "加法器”是8位宽，但参与运算的有效数字实际只有4位

### 优化方案分析

1. “被乘数奇存器”缩减为4位而且取消左移功能
2. “乘数寄存器”4位宽带右移但其中有效数字每周期減少1位，取消它，把乘数放进乘积寄存器
3. “乘积寄存器”增加右移功能乘积初始值置于其中高4位，随着运算过程不断右移
4. “加法器”8位宽，但参与运算的有效数字实际只有4位

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.23.38@2x.png" alt="CleanShot 2024-03-27 at 19.23.38@2x" style="zoom:30%;" />

### N位乘法器的实现结构

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.24.27@2x.png" alt="CleanShot 2024-03-27 at 19.24.27@2x" style="zoom:30%;" />

## 5.5 除法的运算过程

### 除法的运算过程（示例1）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.28.39@2x.png" alt="CleanShot 2024-03-27 at 19.28.39@2x" style="zoom:30%;" />

### 除法的运算过程（示例2）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.32.54@2x.png" alt="CleanShot 2024-03-27 at 19.32.54@2x" style="zoom:30%;" />

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.35.42@2x.png" alt="CleanShot 2024-03-27 at 19.35.42@2x" style="zoom:30%;" />

## 5.6 除法器的实现

### 32-bit 除法器的工作流程图

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.39.19@2x.png" alt="CleanShot 2024-03-27 at 19.39.19@2x" style="zoom:30%;" />

### 4-bit 除法器的实现示例

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.41.00@2x.png" alt="CleanShot 2024-03-27 at 19.41.00@2x" style="zoom:30%;" />

### 除法器的工作过程

#### 除法器的工作过程（0）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.45.53@2x.png" alt="CleanShot 2024-03-27 at 19.45.53@2x" style="zoom:30%;" />

#### 除法器的工作过程（1）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.46.58@2x.png" alt="CleanShot 2024-03-27 at 19.46.58@2x" style="zoom:30%;" />

#### 除法器的工作过程（2）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.47.54@2x.png" alt="CleanShot 2024-03-27 at 19.47.54@2x" style="zoom:30%;" />

#### 除法器的工作过程（2b）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.48.41@2x.png" alt="CleanShot 2024-03-27 at 19.48.41@2x" style="zoom:30%;" />



<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.49.03@2x.png" alt="CleanShot 2024-03-27 at 19.49.03@2x" style="zoom:30%;" />

#### 除法器的工作过程（3）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.49.34@2x.png" alt="CleanShot 2024-03-27 at 19.49.34@2x" style="zoom:30%;" />

#### 除法器的工作过程（4）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.50.07@2x.png" alt="CleanShot 2024-03-27 at 19.50.07@2x" style="zoom:30%;" />

#### 除法器的工作过程（1） 第二轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.50.51@2x.png" alt="CleanShot 2024-03-27 at 19.50.51@2x" style="zoom:30%;" />

#### 除法器的工作过程（第二轮～第四轮）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.51.27@2x.png" alt="CleanShot 2024-03-27 at 19.51.27@2x" style="zoom:30%;" />

#### 除法器的工作过程（1） 第五轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.52.19@2x.png" alt="CleanShot 2024-03-27 at 19.52.19@2x" style="zoom:30%;" />

#### 除法器的工作过程（2） 第五轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.52.54@2x.png" alt="CleanShot 2024-03-27 at 19.52.54@2x" style="zoom:30%;" />

#### 除法器的工作过程（2a） 第五轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.53.25@2x.png" alt="CleanShot 2024-03-27 at 19.53.25@2x" style="zoom:30%;" />

#### 除法器的工作过程（3） 第五轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.54.12@2x.png" alt="CleanShot 2024-03-27 at 19.54.12@2x" style="zoom:30%;" />

#### 除法器的工作过程（4） 第五轮

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.54.41@2x.png" alt="CleanShot 2024-03-27 at 19.54.41@2x" style="zoom:30%;" />

### 32-bit 除法器的实现

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.55.18@2x.png" alt="CleanShot 2024-03-27 at 19.55.18@2x" style="zoom:30%;" />

## 5.7 除法器的优化

### 除法器的实现（第一版）

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 19.57.52@2x.png" alt="CleanShot 2024-03-27 at 19.57.52@2x" style="zoom:30%;" />

### 除法器的面积优化

从减小面积的角度进行分析：
1. 除数寄存器实际只用了一半
2. 商寄存器初始时是空的，从右到左逐位填满
3. 余数寄存器初始时是满的，有实际意义的位从左到右逐渐減少

优化方案
1. 除数寄存器缩小为32-bit，无需支持移位
2. 取消商寄存器
3. 64-bit ALU缩小为32-bit
4. 余数寄存器只有高32-bit参与加减法运算
5. 余数寄存器需 支持左移和右移
6. 商从右端逐位移入余数寄存器
7. 运算结束时，商占据余数寄存器的低32-bit

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 20.25.23@2x.png" alt="CleanShot 2024-03-27 at 20.25.23@2x" style="zoom:30%;" />

余数寄存器支持右移：如果需要回退，那么需要右移来删除余数寄存器最右边的错误的商1

### 除法的性能优化分析

回顾：乘法的特点

1. 每个部分积都是独立的
2. 可以并行计算各个部分积

除法有判断，不是独立的

<img src="./5.乘法器和除法器.assets/CleanShot 2024-03-27 at 20.28.16@2x.png" alt="CleanShot 2024-03-27 at 20.28.16@2x" style="zoom:30%;" />