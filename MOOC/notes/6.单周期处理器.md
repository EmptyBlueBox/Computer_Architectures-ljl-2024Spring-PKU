# 第六章 - 单周期处理器

## 6.1 处理器的设计步骤

### MIPS 指令系统的简化版本

![mips_simplified](6.单周期处理器.assets/mips_simplified.png)

指令格式：指令被编码为 32 位的二进制串。

-   R 型指令：用于寄存器之间的运算，分为**六个位域**，包含操作码（opcode）、源寄存器（rs）、目标寄存器（rt）、目的寄存器（rd）、移位量（shamt，保留）和功能码（funct）。
-   I 型指令：用于立即数运算和访问内存，分为**四个位域**，包含操作码（opcode）、源寄存器（rs）、目标寄存器（rt）和立即数（immediate）。

指令的含义：

-   `addu rd,rs,rt`: 无符号加法，将寄存器 rs 和 rt 的值相加，结果存入 rd。
-   `subu rd,rs,rt`: 无符号减法，从寄存器 rs 的值中减去 rt 的值，结果存入 rd。
-   `ori rt,rs,imm16`: 寄存器 rs 的值和立即数 imm16 进行逻辑或（OR）操作，结果存入 rt。
-   `lw rt,imm16(rs)`: 从内存地址（寄存器 rs 的值加上立即数 imm16）加载字到寄存器 rt。
-   `sw rt,imm16(rs)`: 将寄存器 rt 的值存储到内存地址（寄存器 rs 的值加上立即数 imm16）。
-   `beq rs,rt,imm16`: 分支等于（branch on equal），如果寄存器 rs 和 rt 的值相等，则跳转到当前地址加上立即数 imm16 指定的位置。

### 指令位域的分解

![instruction_bit_decomposition](6.单周期处理器.assets/instruction_bit_decomposition.png)

-   R 指令需求：存放指令的存储器，可读， 地址和数据均为 32 位
-   I 指令需求：存放指令地址的 32 位寄存器

### 指令的操作

-   `ADDU`：无符号加法，结果存储在目的寄存器`rd`中。

    指令格式：`ADDU R[rd] ← R[rs] + R[rt]; PC ← PC+4`

-   `SUBU`：无符号减法，结果存储在目的寄存器`rd`中。

    指令格式：`SUBU R[rd] ← R[rs] - R[rt]; PC ← PC+4`

-   `ORI`：寄存器`rs`的内容与立即数`Imm16`进行逻辑或操作，结果存储在寄存器`rt`中。

    指令格式：`ORI R[rt] ← R[rs] | zero_ext(Imm16); PC ← PC+4`

由此得出，我们需要的运算器需要支持的操作数包括：

-   两个寄存器
-   一个寄存器和一个扩展后的立即数

### 指令的操作

-   `LOAD`：从内存中加载数据到寄存器`rt`。

    指令格式：`LOAD R[rt] ← MEM[R[rs]+sign_ext(Imm16)]; PC ← PC+4`

-   `STORE`：将寄存器`rt`的数据存储到内存地址。

    指令格式：`STORE MEM[R[rs]+sign_ext(Imm16)] ← R[rt]; PC ← PC+4`

-   `BEQ`：如果寄存器`rs`和`rt`的值相等，则跳转到指定的地址。

    指令格式：`BEQ if (R[rs]==R[rt]) then PC ← PC+4 + (sign_ext(Imm16)<<2) else PC ← PC+4`

由此得出，我们需要的运算器需要支持的操作数包括：

-   两个寄存器并比较它们的值
-   一个寄存器和一个扩展后的立即数进行地址计算

需求：

-   存放数据的存储器，可读写，地址和数据均为 32 位
-   16 位立即数符号扩展为 32 位
-   比较两个数，判断是否相等
-   PC 寄存器支持两种自增方式，加 4 或加一个立即数
