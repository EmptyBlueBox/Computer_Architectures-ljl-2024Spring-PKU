# 第二章 - 计算机基本结构

## 2.1 电子计算机的兴起

### ENIAC 1946

首台 **通用** 计算机，1946.2.14，宾夕法尼亚大学

这台计算机被命名为 ENIAC，在一九四三年正式开始设计，由莫克利任首席顾问。

主要特征：

-   组成：18000 个电子管
-   性能：每秒 5000 次加法
-   功率：150 千瓦
-   占地：170 平方米
-   重量：30 吨
-   成本：50 万美元

当然，他实际是在二战之后才完成的，并没有为二战的火炮射击表做出什么贡献。

**如果不加通用这两个字，恐怕还会有不小的争议。**

作为研制小组的顾问，冯诺依曼参与了很多讨论，并提出了自己的意见和建议。

但是插拔这些开关是一件非常费时费力的工作，往往经过几天的配置连线才能计算新工作，但是这件事情完全可以像受程序管理的数据一样存放于主存储器中。

### ABC 1939

ABC： **首台计算机** ，ENIAC 的参考

由美国艾尔瓦州立大学物理系的阿塔纳索夫副教授和他的学生贝里早在 1939 年设计完成

### EDVAC 1949

基于《关于 EDVAC 的报告草案》。

EDVAC 于 1949 年 8 月交付给弹道研究实验室，在发现和解决许多问题之后，直到 1951 年 EDVAC 才开始运行

EDVAC：冯诺依曼结构，但 **不是** 首台冯诺依曼结构计算机，EDSAC 才是。

-   实现 **存储程序** 概念，大幅提升了任务效率（即程序存储在存储器里）
-   指令和数据采用 **二进制** ，极大简化了逻辑线路
-   由五个基本部分组成：运算器，控制器，存储器，输入设备，输出设备

### EDSAC：第一台实用的存储程序式（冯诺依曼结构）计算机

EDSAC：第一台实用的存储程序式（冯诺依曼）计算机，参照 EDVAC，1949.5.6，英国剑桥

主设计师：莫里斯・威尔克斯

以 EDVAC 为蓝本设计和建造

五个组成部分

-   运算器和控制器：电子管
-   存储器：水银延迟线
-   输入设备：从穿孔纸带输入
-   输出设备：电传打印机

### UNIVAC : UNIVersal Automatic Computer

1951 年，第一台 UNIVAC 交付美国人口普查局

-   设计开始于埃克特 - 莫克利计算机公司（EMCC）
-   完成于雷明顿。兰德公司（Remington Rand）

1952 年，UNIVAC 一夜成名：UNIVAC 在统计了部分选票之后，最先准确的预测了艾森豪威尔将赢得选举。

### UNIVAC：开启了商用计算机的时代

1950 年代，众多公司进入电子计算机领域

1953 年，IBM 成功转型，推出大型计算机 IBM701

1955 年，IBM 占领了 70% 的市场

"IBM 和七个小矮人〞：Burroughs, Sperry Rand (UNIVAC), CDC, Honeywell, GE, RCA, NCR

而在这七个小矮人中，也有已经并购了 UNIVAC 研制部门的斯普利・兰德公司。

### Altair 8800

1975 年，第一台微型计算机 Altair 8800 诞生，由爱德华・罗伯茨设计，在 MITS（微型计算机系统公司）生产。

-   Intel 8080 处理器
-   256 字节内存
-   面板提供简单的输入输出，输入是开关，输出是灯

乔布斯和沃兹尼亚克学习了它，在 1976 年推出了 Apple I

## 2.2 冯・诺依曼结构的要点

### 冯・诺依曼和《关于 EDVAC 的报告草案》

长度：101 页，未完成稿

本文论述了两个重要的设计思想：

-   存储程序（而不是开关连线）
-   二进制（而不是十进制）

明确了计算机的五个部分：

-   运算器
-   控制器
-   存储器
-   输入设备
-   输出设备

### Intel 4004：世界上第一个商业微处理器

-   诞生于 1971 年
-   面积：4.2mm×3.2mm
-   制造工艺：10 微米
-   晶体管数量：2250
-   主频：最高 740KHz
-   字长：4 位

已经有 ROM、RAM、移位寄存器

### MCS-4 ( Micro Computer Set)

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 16.52.50@2x.png" alt="CleanShot 2024-03-02 at 16.52.50@2x" style="zoom:50%;" />

4001 不属于冯诺依曼五大组成部分

### 冯 - 诺依曼结构的要点

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 16.58.29@2x.png" alt="CleanShot 2024-03-02 at 16.58.29@2x" style="zoom:50%;" />

计算机的五大组成部分包括：

-   运算器（CA: Central Arithmetical）
-   控制器（CC: Central Control）
-   存储器（M: Memory）
-   输入设备（I: Input）
-   输出设备（O: Output）

其他要点

-   计算机由运算器、控制器、存储器、输入设备和输出设备共 5 个部分组成。
-   数据和程序均以二进制代码形式存放在存储器中， **不加区别** ，存放位置由存储器的地址指定。
-   计算机工作时能够 **自动** 从存储器中取出指令并执行。

### 冯・诺依曼结构的核心

| 冯 - 诺依曼结构               | 现代计算机                    |
| ----------------------------- | ----------------------------- |
| 运算器 CA 和控制器 CC，合称 C | CPU (Central Processing Unit) |
| 存储器 M                      | 主存储器（主存、内存）        |

## 2.3 冯・诺依曼结构的小故事

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.04.31@2x.png" alt="CleanShot 2024-03-02 at 17.04.31@2x" style="zoom:30%;" />

计算机执行一条指令的主要步骤

-   第一步：取指（Fetch），注意还会更新 PC（下一步指令的地址）
-   第二步：译码（Decode）
-   第三步：执行（Execute）
-   第四步：回写（Write-back），即保存结果

## 2.4 计算机结构的简化模型

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.23.32@2x.png" alt="CleanShot 2024-03-02 at 17.23.32@2x" style="zoom:30%;" />

两个部分：CPU、存储器，彼此通过总线（控制总线、地址总线、数据总线）相连

### 模型机的存储器

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.14.15@2x.png" alt="CleanShot 2024-03-02 at 17.14.15@2x" style="zoom:30%;" />

控制总线：读、写、完成等控制信号

地址总线：如果地址总线宽度为 n，则 CPU 能管理的存储单元最多为 $2^n$ 个

数据总线：数据总线宽度一般为存储单元位宽的整数倍

### 模型机的 CPU：控制器

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.15.45@2x.png" alt="CleanShot 2024-03-02 at 17.15.45@2x" style="zoom:30%;" />

控制器用于控制计算机各部件完成取指令、分析指令和执行指令等功能，主要组成部分如下：

-   指令寄存器 IR：Instruction Register
-   程序计数器 PC：Program Counter
-   存储器地址寄存器 MAR：Memory Address Register
-   存储器数据寄存器 MDR：Memory Data Register
-   指令译码部件：对 IR 中的指令进行译码，确定存放的是哪一条指令
-   控制电路：产生控制信号，在时序脉冲的同步下控制各个部件的动作

#### 控制器的基本组成

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.17.56@2x.png" alt="CleanShot 2024-03-02 at 17.17.56@2x" style="zoom:30%;" />

1.  **IR（指令寄存器）** ：存放当前正在执行或即将执行的指令。

2.  **PC（程序计数器）** ：存放下一条指令的存储单元地址，并具有自动增量的功能。

3.  **MAR（存储地址寄存器）** ：在访问存储时，用于存放存储单元的地址。

4.  **MDR（存储数据寄存器）** ：在访问存储时，用于存放对存储单元进行读 / 写的数据。

5.  **指令译码部件** ：对 IR 中的指令进行译码，以确定 IR 中存放的是哪一条指令。

6.  **控制电路** ：产生控制信号，在时序脉冲的同步下控制各个部件的动作。

### 模型机的 CPU：运算器

核心组件：ALU（算术逻辑单元）

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.19.45@2x.png" alt="CleanShot 2024-03-02 at 17.19.45@2x" style="zoom:30%;" />

运算器用于算术运算和逻辑运算

-   常见算术运算：加、减、乘、除等
-   常见逻辑运算非、与、或等
-   产生状态标志并保存
-   存在通用寄存器 Reg，用以临时存放数据

#### 运算器的基本组成

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.21.13@2x.png" alt="CleanShot 2024-03-02 at 17.21.13@2x" style="zoom:30%;" />

### CPU 的内部总线

内部总线：用于在 CPU 内部各个部件之间传递数据

## 2.5 计算机执行指令的过程

### 第一步：取指

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.30.40@2x.png" alt="CleanShot 2024-03-02 at 17.30.40@2x" style="zoom:30%;" />

控制器将指令的地址送往存储器

存储器按给定的地址读出指令内容，送回控制器

PC 寄存器更新

1. PC 寄存器中存放的是下一条指令的地址，发往 MAR，走地址总线发往储存器的 MAR，同时控制总线发出读取指令的命令
2. 存储器根据 MAR 中的地址，将指令送到 MDR 中，走数据总线发往控制器的 MDR
3. 控制器将 MDR 中的指令走内部总线发往 IR 中，同时 PC 中的地址更新

### 第二步：译码

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.31.45@2x.png" alt="CleanShot 2024-03-02 at 17.31.45@2x" style="zoom:30%;" />

### 第三步：执行

控制器从通用寄存器或存储器取出操作数

控制器命令运算器对操作数进行指令规定的运算

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.39.51@2x.png" alt="CleanShot 2024-03-02 at 17.39.51@2x" style="zoom:30%;" />

### 第四步：回写

更新寄存器

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.41.29@2x.png" alt="CleanShot 2024-03-02 at 17.41.29@2x" style="zoom:30%;" />

## 2.6 计算机输入和输出

-   输入设备，1：input
-   输出设备，O：output
-   外部记录介质，R：outside recording medium

电传打印机输出的纸张也可以认为是外部记录介质 R。

连接：将三个总线连接到输入输出设备

“输入输出” 的简单场景：

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.47.55@2x.png" alt="CleanShot 2024-03-02 at 17.47.55@2x" style="zoom:30%;" />

现代计算机中，输入输出设备的板卡都集成在主板的南桥芯片中。高性能的显示，还是需要独立的显卡。

## 2.7 冯诺依曼结构和具体实现

### 冯 - 诺依曼结构原理与实现的对应

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.55.43@2x.png" alt="CleanShot 2024-03-02 at 17.55.43@2x" style="zoom:30%;" />

硬盘 - 南桥 - 北桥 - CPU

BIOS 芯片（在南桥上，ROM，不丢失，输入 R），对应 BIOS（Basic Input Output System）程序

北桥芯片提供了各个芯片之间的连接

### 南北桥架构的演变

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.56.21@2x.png" alt="CleanShot 2024-03-02 at 17.56.21@2x" style="zoom:30%;" />

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.57.00@2x.png" alt="CleanShot 2024-03-02 at 17.57.00@2x" style="zoom:30%;" />

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.57.41@2x.png" alt="CleanShot 2024-03-02 at 17.57.41@2x" style="zoom:30%;" />

现代计算机中，北桥的重要芯片移动到了 CPU 中，北桥和南桥整合形成了 PCH（Platform Controller Hub，平台控制器集线器），三片变成了两片。

<img src="./2.计算机基本结构.assets/CleanShot 2024-03-02 at 17.58.30@2x.png" alt="CleanShot 2024-03-02 at 17.58.30@2x" style="zoom:30%;" />

系统芯片（Sytem-on-a-Chip, SoC）：进一步缩减，将计算机或其他电子系统集成单一芯片的集成电路，举例：MacBook Air 的 M1 芯片

摩尔定律：当价格不变时，集成电路上可容纳的晶体管数目，约每隔 18 个月便会增加一倍，性能也将提升一倍。描述了集成电路的发展 / 复杂速度。
